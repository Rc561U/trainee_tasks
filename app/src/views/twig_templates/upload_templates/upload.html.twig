{% extends 'base.html.twig' %}
{% block css %}
    <link rel="stylesheet" href="../../resources/css/style.css">{% endblock %}
{% block title %}<title>Upload</title>{% endblock %}
{% block body %}


    {% block nav %}
        {% include '_navNew.html.twig' %}
    {% endblock %}
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Upload</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="message" id="message">
                    </div>
                    <div class="row ">
                        <div class="col">
                            <form method="post" id="upload_form" onsubmit="submitForm(event)"
                                  enctype="multipart/form-data">
                                <div id="statusMessage">

                                </div>
                                <div>
                                    <input class="form-control" type="file" name="fileToUpload" id="fileToUpload"
                                           required>
                                </div>
                                <div class="mt-3">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
                                    </button>
                                    <input class="btn btn-primary" type="submit" value="Upload" name="submit">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="container">
        <div class="box">
            <h4 class="display-4 text-center">Uploads files</h4><br>
            <!-- Button trigger modal -->
            {% if data.access is defined and data.access %}
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    Upload new file
                </button>
            {% endif %}


            <table class="table table-striped">
                <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Preview</th>
                    <th scope="col">Size</th>
                    <th scope="col">Type</th>
                    <th scope="col">Creation date</th>
                    <th scope="col">Resolution</th>
                    <th scope="col">Upload date</th>
                    <th scope="col">Action</th>
                </tr>
                </thead>
                <tbody>
                <tr>

                    {% for file in data %}
                    {% set counter = ( counter | default(0) ) + 1 %}
                    {% set megabyte = (file.size / (1024 ** 2))|round(3) %}
                    {% if megabyte %}
                    <td>{{ counter }}</td>
                    <td>
                        {% if file.mime == 'image/jpeg' and file.mime is not null %}
                            <img src="{{ file.path }}" title="{{ file.name }}" width="100" height="100"
                                 alt="{{ file.name }}">


                        {% else %}
                            <img src="/resources/assets/text-document.png" title="{{ file.name }}" width="100"
                                 height="100" alt="{{ file.name }}">

                        {% endif %}
                    </td>
                    <td>{{ megabyte }} Mb</td>
                    <td>
                        {% if file.mime == 'image/jpeg' %}
                            Image
                        {% else %}
                            Text
                        {% endif %}
                    </td>
                    <td>
                        {% if file.created_date is defined and file.created_date is not null %}
                            {{ file.created_date|date("m-d-Y") }}
                        {% else %}
                            No data
                        {% endif %}
                    </td>
                    <td>
                        {% if file.height is not null %}
                            {{ file.height }} x {{ file.weight }}
                        {% endif %}
                    </td>
                    <td>{{ file.upload_date }}</td>

                    <td>
                        <a href="{{ file.path }}" class="btn btn-success" download>Download</a>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}

                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script src="/resources/js/upload.js" defer></script>{% endblock %}
